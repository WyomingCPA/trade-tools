import{_ as w,a as d,r as a,o as y,f as F,g as n,h as i,d as l,t as m,k as u}from"./index.c2d02297.js";import{d as C}from"./debounce.e8d92a1a.js";import{l as R}from"./index.9bc537e3.js";const x={name:"StockAll",components:{},data(){const t=[],e="";return{count:{type:Number},loading:!1,items:t,columns:[{key:"name",sortable:!0},{key:"ticker",sortable:!0},{key:"figi",sortable:!0},{key:"currency",width:80},{key:"last_price",width:80}],input:e,filter:e,isDebounceInput:!1,isCustomFilteringFn:!1,filteredCount:t.length,filtered:t,selectedItemsEmitted:[],listPrice:Array,currentPage:1,serverParams:{name:""}}},methods:{filterExact(t){var e;return this.filter===""?!0:((e=t==null?void 0:t.toString)==null?void 0:e.call(t))===this.filter},updateParams(t){this.serverParams=Object.assign({},this.serverParams,t)},onPageChange(t){console.log(this.currentPage),this.updateParams({page:this.currentPage}),this.fetchRows()},onPerPageChange(t){this.updateParams({perPage:t.currentPerPage}),this.fetchRows()},onSearch(t){this.updateParams({name:t}),this.fetchRows()},updateFilter(t){this.filter=t},debouncedUpdateFilter:C(function(t){this.updateFilter(t)},600),filterPrice:function(t){this.filter=t,this.input=t},fetchRows(){let t=this;this.loading=!0,d.request({method:"post",url:"/api/stock/all",params:this.serverParams,paramsSerializer:e=>R.stringify(e)}).then(e=>{t.items=e.data.stocks,t.count=e.data.count,t.loading=!1,console.log(this.pages)}).catch(e=>{console.log(e),t.loading=!1})},resetInfoModal(){this.infoModal.title="",this.infoModal.content=""},favorite:function(t,e){let r=this;this.loading=!0,console.log(r.selectedItemsEmitted),d.get("/sanctum/csrf-cookie").then(f=>{d.post("/api/stock/rub",{selRows:r.selectedItemsEmitted}).then(s=>{s.status?(console.log("\u0412\u044B\u0437\u0432\u0430\u043B\u0438 \u0430\u043B\u0435\u0440\u0442"),this.$vaToast.init({message:"\u0418\u043D\u0441\u0442\u0440\u0443\u043C\u0435\u043D\u0442 \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D \u0432 \u0438\u0437\u0431\u0440\u0430\u043D\u043D\u043E\u0435",color:"success"}),this.fetchRows(),r.loading=!1):(console.log("\u041D\u0435 \u0440\u0430\u0431\u043E\u0442\u0430\u0435\u0442"),console.log(s.status),r.loading=!1)})})}},computed:{customFilteringFn(){return this.isCustomFilteringFn?this.filterExact:void 0},pages(){return this.perPage&&this.perPage!==0?Math.ceil(this.count/this.perPage):this.count}},watch:{input(t){this.isDebounceInput?this.debouncedUpdateFilter(t):(console.log(t),this.updateParams({name:t}),this.fetchRows(),this.updateFilter(t))},currentPage:function(t){this.updateParams({page:t}),this.fetchRows()}},created(){this.fetchRows()}},I={class:"grid md:grid-cols-2 gap-6 mb-6"},S={class:"row"},E={class:"col"},V=u(" \u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0432 \u0438\u0437\u0431\u0440\u0430\u043D\u043D\u043E\u0435 "),N=["href"],M={colspan:"6"},U={class:"flex justify-center mt-4"},A=u(" Number of filtered items: ");function B(t,e,r,f,s,c){const h=a("va-input"),p=a("va-button"),g=a("va-pagination"),_=a("va-data-table"),v=a("va-chip"),P=a("va-alert"),b=a("va-card-content"),k=a("va-card");return y(),F(k,null,{default:n(()=>[i(b,null,{default:n(()=>[l("div",I,[i(h,{modelValue:s.input,"onUpdate:modelValue":e[0]||(e[0]=o=>s.input=o),placeholder:"Filter...",class:"w-full"},null,8,["modelValue"])]),l("div",S,[l("div",E,[i(p,{onClick:c.favorite},{default:n(()=>[V]),_:1},8,["onClick"])])]),i(_,{items:s.items,columns:s.columns,filter:s.filter,"filter-method":c.customFilteringFn,onFiltered:e[2]||(e[2]=o=>s.filteredCount=o.items.length),loading:s.loading,selectable:"","selected-color":"warning",onSelectionChange:e[3]||(e[3]=o=>s.selectedItemsEmitted=o.currentSelectedItems)},{"cell(name)":n(({rowData:o})=>[l("a",{class:"link",target:"_blank",href:"https://www.tinkoff.ru/invest/stocks/"+o.ticker},m(o.name),9,N)]),bodyAppend:n(()=>[l("tr",null,[l("td",M,[l("div",U,[i(g,{modelValue:s.currentPage,"onUpdate:modelValue":e[1]||(e[1]=o=>s.currentPage=o),pages:c.pages},null,8,["modelValue","pages"])])])])]),_:1},8,["items","columns","filter","filter-method","loading"]),i(P,{class:"!mt-6",color:"info",outline:""},{default:n(()=>[A,i(v,null,{default:n(()=>[u(m(s.count),1)]),_:1})]),_:1})]),_:1})]),_:1})}var q=w(x,[["render",B],["__scopeId","data-v-589426ec"]]);export{q as default};
